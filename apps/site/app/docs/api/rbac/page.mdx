---
title: RBAC API
description: MTPC RBAC API 参考
---

# RBAC API

MTPC RBAC 提供了基于角色的访问控制 API。

## createRBACPlugin

创建 RBAC 插件。

### 类型定义

```typescript
function createRBACPlugin(config?: RBACPluginConfig): RBACPlugin
```

### 参数

| 参数 | 类型 | 必填 | 描述 |
|------|------|------|------|
| config | [`RBACPluginConfig`](#rbacpluginconfig) | 否 | RBAC 插件配置 |

### 返回值

返回 [`RBACPlugin`](#rbacplugin) 实例。

### 示例

```typescript
import { createRBACPlugin } from '@mtpc/rbac'

const rbacPlugin = createRBACPlugin({
  store: rbacStore,
})

mtpc.use(rbacPlugin)
```

## RBACPluginConfig

RBAC 插件配置接口。

### 类型定义

```typescript
interface RBACPluginConfig {
  store?: RBACStore
  cache?: CacheConfig
}
```

### 属性

| 属性 | 类型 | 必填 | 描述 |
|------|------|------|------|
| store | [`RBACStore`](#rbacstore) | 否 | RBAC 存储 |
| cache | [`CacheConfig`](#cacheconfig) | 否 | 缓存配置 |

### 示例

```typescript
const config: RBACPluginConfig = {
  store: rbacStore,
  cache: {
    enabled: true,
    ttl: 300,
  },
}
```

## RBACPlugin

RBAC 插件类。

### 方法

#### createRole()

创建角色。

```typescript
async createRole(
  name: string,
  options: CreateRoleOptions
): Promise<Role>
```

#### updateRole()

更新角色。

```typescript
async updateRole(
  id: string,
  options: UpdateRoleOptions
): Promise<Role>
```

#### deleteRole()

删除角色。

```typescript
async deleteRole(id: string): Promise<void>
```

#### getRole()

获取角色。

```typescript
async getRole(id: string): Promise<Role | null>
```

#### getRoles()

获取所有角色。

```typescript
async getRoles(): Promise<Role[]>
```

#### bindRole()

绑定角色到用户。

```typescript
async bindRole(
  userId: string,
  roleId: string
): Promise<RoleBinding>
```

#### unbindRole()

解绑角色。

```typescript
async unbindRole(
  userId: string,
  roleId: string
): Promise<void>
```

#### getRoleBindings()

获取用户角色绑定。

```typescript
async getRoleBindings(userId: string): Promise<RoleBinding[]>
```

#### getRolePermissions()

获取角色权限。

```typescript
async getRolePermissions(roleId: string): Promise<Permission[]>
```

## CreateRoleOptions

创建角色选项接口。

### 类型定义

```typescript
interface CreateRoleOptions {
  permissions?: Permission[]
  metadata?: RoleMetadata
}
```

### 属性

| 属性 | 类型 | 必填 | 描述 |
|------|------|------|------|
| permissions | [`Permission[]`](#permission) | 否 | 权限列表 |
| metadata | [`RoleMetadata`](#rolemetadata) | 否 | 角色元数据 |

### 示例

```typescript
const options: CreateRoleOptions = {
  permissions: [
    { resource: 'user', action: 'create' },
    { resource: 'user', action: 'read' },
  ],
  metadata: {
    description: '管理员角色',
  },
}
```

## UpdateRoleOptions

更新角色选项接口。

### 类型定义

```typescript
interface UpdateRoleOptions {
  permissions?: Permission[]
  metadata?: RoleMetadata
}
```

### 属性

| 属性 | 类型 | 必填 | 描述 |
|------|------|------|------|
| permissions | [`Permission[]`](#permission) | 否 | 权限列表 |
| metadata | [`RoleMetadata`](#rolemetadata) | 否 | 角色元数据 |

### 示例

```typescript
const options: UpdateRoleOptions = {
  permissions: [
    { resource: 'user', action: 'create' },
    { resource: 'user', action: 'read' },
    { resource: 'user', action: 'update' },
  ],
}
```

## Role

角色接口。

### 类型定义

```typescript
interface Role {
  id: string
  name: string
  permissions: Permission[]
  metadata?: RoleMetadata
  createdAt: Date
  updatedAt: Date
}
```

### 属性

| 属性 | 类型 | 必填 | 描述 |
|------|------|------|------|
| id | `string` | 是 | 角色 ID |
| name | `string` | 是 | 角色名称 |
| permissions | [`Permission[]`](#permission) | 是 | 权限列表 |
| metadata | [`RoleMetadata`](#rolemetadata) | 否 | 角色元数据 |
| createdAt | `Date` | 是 | 创建时间 |
| updatedAt | `Date` | 是 | 更新时间 |

### 示例

```typescript
const role: Role = {
  id: 'role-1',
  name: 'admin',
  permissions: [
    { resource: 'user', action: 'create' },
    { resource: 'user', action: 'read' },
  ],
  metadata: {
    description: '管理员角色',
  },
  createdAt: new Date(),
  updatedAt: new Date(),
}
```

## RoleMetadata

角色元数据接口。

### 类型定义

```typescript
interface RoleMetadata {
  description?: string
  displayName?: string
  tags?: string[]
}
```

### 属性

| 属性 | 类型 | 必填 | 描述 |
|------|------|------|------|
| description | `string` | 否 | 描述 |
| displayName | `string` | 否 | 显示名称 |
| tags | `string[]` | 否 | 标签 |

### 示例

```typescript
const metadata: RoleMetadata = {
  description: '管理员角色',
  displayName: '管理员',
  tags: ['admin', 'system'],
}
```

## RoleBinding

角色绑定接口。

### 类型定义

```typescript
interface RoleBinding {
  id: string
  userId: string
  roleId: string
  createdAt: Date
}
```

### 属性

| 属性 | 类型 | 必填 | 描述 |
|------|------|------|------|
| id | `string` | 是 | 绑定 ID |
| userId | `string` | 是 | 用户 ID |
| roleId | `string` | 是 | 角色 ID |
| createdAt | `Date` | 是 | 创建时间 |

### 示例

```typescript
const binding: RoleBinding = {
  id: 'binding-1',
  userId: 'user-1',
  roleId: 'role-1',
  createdAt: new Date(),
}
```

## Permission

权限接口。

### 类型定义

```typescript
interface Permission {
  resource: string
  action: string
  scope?: PermissionScope
}
```

### 属性

| 属性 | 类型 | 必填 | 描述 |
|------|------|------|------|
| resource | `string` | 是 | 资源名称 |
| action | `string` | 是 | 操作名称 |
| scope | [`PermissionScope`](#permissionscope) | 否 | 权限范围 |

### 示例

```typescript
const permission: Permission = {
  resource: 'user',
  action: 'create',
  scope: 'tenant',
}
```

## PermissionScope

权限范围类型。

### 类型定义

```typescript
type PermissionScope = 'global' | 'tenant' | 'department' | 'team' | 'own'
```

### 值

| 值 | 描述 |
|----|------|
| `global` | 全局范围 |
| `tenant` | 租户范围 |
| `department` | 部门范围 |
| `team` | 团队范围 |
| `own` | 自己的范围 |

### 示例

```typescript
const scope: PermissionScope = 'tenant'
```

## RBACStore

RBAC 存储接口。

### 类型定义

```typescript
interface RBACStore {
  createRole(role: Role): Promise<Role>
  updateRole(id: string, role: Partial<Role>): Promise<Role>
  deleteRole(id: string): Promise<void>
  getRole(id: string): Promise<Role | null>
  getRoles(): Promise<Role[]>
  bindRole(binding: RoleBinding): Promise<RoleBinding>
  unbindRole(userId: string, roleId: string): Promise<void>
  getRoleBindings(userId: string): Promise<RoleBinding[]>
  getRolePermissions(roleId: string): Promise<Permission[]>
}
```

### 方法

| 方法 | 返回值 | 描述 |
|------|--------|------|
| createRole | `Promise<Role>` | 创建角色 |
| updateRole | `Promise<Role>` | 更新角色 |
| deleteRole | `Promise<void>` | 删除角色 |
| getRole | `Promise<Role \| null>` | 获取角色 |
| getRoles | `Promise<Role[]>` | 获取所有角色 |
| bindRole | `Promise<RoleBinding>` | 绑定角色 |
| unbindRole | `Promise<void>` | 解绑角色 |
| getRoleBindings | `Promise<RoleBinding[]>` | 获取角色绑定 |
| getRolePermissions | `Promise<Permission[]>` | 获取角色权限 |

### 示例

```typescript
class DatabaseRBACStore implements RBACStore {
  async createRole(role: Role): Promise<Role> {
    // 实现创建角色逻辑
    return role
  }

  async updateRole(id: string, role: Partial<Role>): Promise<Role> {
    // 实现更新角色逻辑
    return updatedRole
  }

  async deleteRole(id: string): Promise<void> {
    // 实现删除角色逻辑
  }

  async getRole(id: string): Promise<Role | null> {
    // 实现获取角色逻辑
    return role
  }

  async getRoles(): Promise<Role[]> {
    // 实现获取所有角色逻辑
    return roles
  }

  async bindRole(binding: RoleBinding): Promise<RoleBinding> {
    // 实现绑定角色逻辑
    return binding
  }

  async unbindRole(userId: string, roleId: string): Promise<void> {
    // 实现解绑角色逻辑
  }

  async getRoleBindings(userId: string): Promise<RoleBinding[]> {
    // 实现获取角色绑定逻辑
    return bindings
  }

  async getRolePermissions(roleId: string): Promise<Permission[]> {
    // 实现获取角色权限逻辑
    return permissions
  }
}
```

## CacheConfig

缓存配置接口。

### 类型定义

```typescript
interface CacheConfig {
  enabled?: boolean
  ttl?: number
  maxSize?: number
}
```

### 属性

| 属性 | 类型 | 必填 | 描述 |
|------|------|------|------|
| enabled | `boolean` | 否 | 是否启用缓存 |
| ttl | `number` | 否 | 缓存过期时间（秒） |
| maxSize | `number` | 否 | 最大缓存数量 |

### 示例

```typescript
const cacheConfig: CacheConfig = {
  enabled: true,
  ttl: 300,
  maxSize: 1000,
}
```

---

**继续学习：** [Hono Adapter API](/docs/api/adapter-hono) →
